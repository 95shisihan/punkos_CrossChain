|编号|题目|阶段|类别|作者|创建|修改|
|---|---|---|---|---|---|---|
|3|源链注册引导|草稿|机制设计|耿一夫|2024-12|2024-12|

# 写作目的

本文档主要介绍新源链加入跨链区的主要流程。

# 注册引导

### 注册前置条件

- 源链此前未注册
- 源链是安全的公链
- 源链支持“广义轻客户端”，即任意用户在可信启动后能够以无需信任的方式读取账本

### 注册关键节点

源链的注册流程有如下几个关键的时间结点：
1. 治理区在跨链区的多链管理合约登记源链的相关信息
2. 注册者将通过审计的跨链合约（例如中继合约、传输合约）部署到中继链，并将合约权限移交**多链管理合约**
3. 治理区在多链管理合约登记跨链合约信息
4. 治理区通过多链管理合约设置跨链合约初始状态
5. 治理区通过多链管理合约启动跨链合约，并同步更新其登记信息

### 中继合约开发流程与审计原则

1. 开发者基于源链规则接口开发源链影子客户端合约
   1. 符合源链的规则（治理区的审计重点）
   2. 不能修改系统合约的接口（已在系统合约模板里实现）
   3. 合约对外的写函数，必须附加系统合约模板的onlyManager修饰符（不影响合约的测试）
   4. 合约内的验证过程不能使用require、revert等回滚的函数
2. 开发者向治理区提交源链影子客户端合约和启动合约的参数，参数分为动态（例如源链最新检查点）和静态（例如源链创世区块），动态参数目前考虑两类可选的审计流程
   1. 动态参数需要标注时效，由治理区紧急审计
   2. 动态参数替换为可获取动态参数的代码
3. 治理区审计通过后，开发者/治理区部署源链中继合约，该合约可基于抽象中继合约和源链影子客户端合约“确定性”生成
4. 中继合约部署者将中继合约权限转移至多链管理合约
5. 治理区通过多链管理合约设置中继合约初始状态，并将其设为工作状态